<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>無標題文件</title>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
<script src="http://code.jquery.com/jquery-1.8.3.js"></script>
<script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
<script>
	$(function(){
		var newgame;
		var tmp;
		var start="true";
		var timeup;
		var timedown;
		var timeright;
		var timeleft;
		var gunflytime;
		var $find;
		var $findgun;
		var $overfind;
		var backtime;
		var movebacktime="";
		var gunspped=8; //子彈速度
		var sumback=200; //隕石生成速度 1000=1s
		var sumbackp=10; //機率sumbackp分之1
		var score=10; //擊破隕石得分數
		//移動速度
		var upspeed=4;
		var downspeed=4;
		var leftspeed=6;
		var rightspeed=6;
		//隕石速度
		var back1speed=1.5;
		var back2speed=2.5;
		var back3speed=1.0;
		var back4speed=0.5;
		var back5speed=2;
		$player=$("#player");	//玩家
		$stage=$(".stage");		//背景
		$mygun=$(".mygun");		//子彈
		$icon=$(".icon");		//記分板
		//起始高度
		$player.css({
			top:(parseFloat($stage.css("height"))-parseFloat($player.css("height")))/2
		})
		$icon.css({
			left:(parseFloat($stage.css("width"))-parseFloat($icon.css("width")))/2
		})
		//移動隕石
		function moveback(){
			$stage.find(".back1").each(function(){
				$(this).css("left",parseFloat($(this).css("left"))-back1speed)
				//刪除隕石
				if ((parseInt($(this).css("left"))<-320)){
					$(this).remove();
				}
			})
			$stage.find(".back2").each(function(){
				$(this).css("left",parseFloat($(this).css("left"))-back2speed)
				//刪除隕石
				if ((parseInt($(this).css("left"))<-320)){
					$(this).remove();
				}
			})
			$stage.find(".back3").each(function(){
				$(this).css("left",parseFloat($(this).css("left"))-back3speed)
				//刪除隕石
				if ((parseInt($(this).css("left"))<-320)){
					$(this).remove();
				}
			})
			$stage.find(".back4").each(function(){
				$(this).css("left",parseFloat($(this).css("left"))-back4speed)
				//刪除隕石
				if ((parseInt($(this).css("left"))<-320)){
					$(this).remove();
				}
			})
			$stage.find(".back5").each(function(){
				$(this).css("left",parseFloat($(this).css("left"))-back5speed)
				//刪除隕石
				if ((parseInt($(this).css("left"))<-320)){
					$(this).remove();
				}
			})
		}
		//隨機生成(移動)隕石
		backtime=setInterval(function(){
			if (rand(0,sumbackp)==0){
				var list=["<div class='back1 back'>2</div>","<div class='back2  back'>2</div>","<div class='back3  back'>2</div>","<div class='back4  back'>2</div>","<div class='back5  back'>2</div>"];
				var temp=rand(0,4)
				$stage.append(list[temp])
				if (temp==0){
					$find=$stage.find(".back1:last")
					$find.css({
						left:parseInt($stage.css("width")),
						top:rand(-300,600),
					})
				}
				else if (temp==1){
					$find=$stage.find(".back2:last")
					$find.css({
						left:parseInt($stage.css("width")),
						top:rand(-300,600),
					})
				}
				else if (temp==2){
					$find=$stage.find(".back3:last")
					$find.css({
						left:parseInt($stage.css("width")),
						top:rand(-300,600),
					})
				}
				else if (temp==3){
					$find=$stage.find(".back4:last")
					$find.css({
						left:parseInt($stage.css("width")),
						top:rand(-300,600),
					})
				}
				else if (temp==4){
					$find=$stage.find(".back5:last")
					$find.css({
						left:parseInt($stage.css("width")),
						top:rand(-300,600),
					})
				}
				if (movebacktime=="")movebacktime=setInterval(moveback,1000/60)
			}
		},sumback)
		//鍵盤滑鼠事件
			//上下左右移動
			//向上
			$(".up").mousedown(function(){
				clearInterval(timeup)
				timeup=setInterval(function(){
					if (start=="true"){
						tmp=(parseFloat($player.css("top")))-upspeed
						if (tmp+parseFloat($player.css("height"))/2>parseFloat($stage.css("top"))){
							$player.css("top",tmp)
						}
					}
				},1000/60)
			})
			$(".up").mouseup(function(){
				clearInterval(timeup)
			})
			$(".up").mouseout(function(){
				clearInterval(timeup)
			})
			//向下
			$(".down").mousedown(function(){
				clearInterval(timedown)
				timedown=setInterval(function(){
					if (start=="true"){
						tmp=(parseFloat($player.css("top")))+downspeed
						if (tmp+parseFloat($player.css("height"))/2<parseFloat($stage.css("height"))){
							$player.css("top",tmp)
						}
					}
				},1000/60)
			})
			$(".down").mouseup(function(){
				clearInterval(timedown)
			})
			$(".down").mouseout(function(){
				clearInterval(timedown)
			})
			//向右
			$(".right").mousedown(function(){
				clearInterval(timeright)
				timeright=setInterval(function(){
					if (start=="true"){
						tmp=(parseFloat($player.css("left")))+rightspeed
						if (tmp+parseFloat($player.css("width"))<parseFloat($stage.css("width"))){
							$player.css("left",tmp)
						}
					}
				},1000/60)
			})
			$(".right").mouseup(function(){
				clearInterval(timeright)
			})
			$(".right").mouseout(function(){
				clearInterval(timeright)
			})
			//向左
			$(".left").mousedown(function(){
				clearInterval(timeleft)
				timeleft=setInterval(function(){
					if (start=="true"){
						tmp=(parseFloat($player.css("left")))-leftspeed
						if (tmp>0){
							$player.css("left",tmp)
						}
					}
				},1000/60)
			})
			$(".left").mouseup(function(){
				clearInterval(timeleft)
			})
			$(".left").mouseout(function(){
				clearInterval(timeleft)
			})
			//禁止右鍵
			$("body").contextmenu(function(x){
				x.preventDefault();
			})
			//空白艦發射子彈
			$("body").keyup(function(x,y){
				if (start=="true"){
					if (x.key==" "){
						$stage.append("<div class='mygun'></div>")
						$find=$stage.find(".mygun:last");
						$find.css({
							left:parseFloat($player.css("left"))+35,
							top:parseFloat($player.css("top"))+10,
						})
						
					}
				}
			})
			//子彈前進
			gunflytime=setInterval(function(){
				$findgun=$stage.find(".mygun").each(function(){
					$(this).css("left",parseFloat($(this).css("left"))+gunspped)
					//刪除子彈(超出螢幕)
					if (parseFloat($(this).css("left"))>parseFloat($stage.css("width"))){
						$(this).remove();
					}
				})
				
			},1000/60)
		//開始遊戲
		function start(){
			
		}
		//隨機整數
		function rand(nn,mm){
			var num=parseInt(Math.random()*(mm-nn+1))+nn
			return num;
		}
		//判斷
		function yn(){
			//判斷子彈位置
			$stage.find(".back").each(function(){
				var tt=$(this)
				var find=$stage.find(".mygun").each(function(){
					if (parseFloat($(this).css("top"))+parseFloat($(this).css("height"))/2>parseFloat(tt.css("top"))//上
					&&parseFloat($(this).css("top"))+parseFloat($(this).css("height"))/2<parseFloat(tt.css("top"))+parseFloat(tt.css("height"))//下
					&&parseFloat($(this).css("left"))+parseFloat($(this).css("width"))/2>parseFloat(tt.css("left"))//左
					&&parseFloat($(this).css("left"))+parseFloat($(this).css("width"))/2<parseFloat(tt.css("left"))+parseFloat(tt.css("width")))//右
					{
						//擊中隕石(消除子彈)
						if (tt.text()==2){
							$(this).remove();
							tt.html(1);
						}
						else{
							//加分
							$(".icon").html(parseInt($(".icon").text())+score+"得分");
							//消除隕石子彈
							$(this).remove();
							tt.remove();
						}
					}
				})
				
			})
		}
		newgame=setInterval(yn,1000/60)
	})
</script>
<style type="text/css">
	.stage{
		background:url("image/stage.jpg");
		width:960px;	
		height:600px;
		position:absolute;
		top:0; left:0; right:0; bottom:0;
		margin:auto;
		overflow: hidden;
	}
	.player{
		background:url("image/fly.png");
		width: 50px;
		height: 30px;
		position: absolute;
		z-index: 1;
	}
	.move{
		width: 40px;
		height: 40px;
		position: absolute;
		z-index: 2;
	}
	.up{
		background:url("image/up.png");
		left: 40px;
		top: 480px;
	}
	.down{
		background:url("image/down.png");
		left: 40px;
		top: 560px;
	}
	.left{
		background:url("image/left.png");
		left: 0px;
		top: 520px;
	}
	.right{
		background:url("image/right.png");
		left: 80px;
		top: 520px;
	}
	.midden{
		background:url("image/midden.png");
		left: 40px;
		top: 520px;
	}
	.mygun{
		background:url("image/mygun.png");
		position: absolute;
		width: 20px;
		height: 10px;
	}
	.back1{
		position: absolute;
		width: 230px;
		height: 220px;
		background: url(image/back1.png);
	}
	.back2{
		position: absolute;
		width: 320px;
		height: 318px;
		background: url(image/back2.png);
	}
	.back3{
		position: absolute;
		width: 68px;
		height: 66px;
		background: url(image/back3.png);
	}
	.back4{
		position: absolute;
		width: 48px;
		height: 44px;
		background: url(image/back4.png);
	}
	.back5{
		position: absolute;
		width: 180px;
		height: 180px;
		background: url(image/back5.png);
	}
	.back{
		font-size:0px;
	}
	.text{
		left: 300px;
		top: 200px;
	}
	.icon{
		position: absolute;
		width: 300px;
		height: 40px;
		background: url("image/icon.png");
		font-size: 60px;
		text-align: center;
		color: gold;
		left: 390px;
	}
</style>
</head>
	
<body>
	<div class="stage">
		<div class="player" id="player"></div>
		<!--移動(上，下，左，右，中)-->
		<div class="move up"></div>
		<div class="move down"></div>
		<div class="move left"></div>
		<div class="move right"></div>
		<div class="move midden"></div>
		<div class="icon">0得分</div>
	</div>
</body>
	
</html>
