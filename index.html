<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>無標題文件</title>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
<script src="http://code.jquery.com/jquery-1.8.3.js"></script>
<script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
<script>
	$(function(){
		var yn;
		var tmp;
		var start="false";
		var timeup;
		var timedown;
		var timeright;
		var timeleft
		var $find;
		var $findgun;
		var $overfind;
		var gunspped=8; 	//子彈速度
		var sumback=500;	//隕石生成速度 1000=1s
		var sumbackp=10; 	//生成隕石機率sumbackp分之1
		var score=10; 		//擊破隕石得分數
		var FPS=60;
		var gasmiss=1000;	//燃料消耗速度
		var gashave=15;		//初始燃料
		var backattack=15;	//撞到隕石損失的燃料
		var sump=5;			//燃料生成機率sump/1s
		var gasspeed=1;		//汽油下降速度
		var stop="true";	//檢查遊戲是否暫停
		//循環時間變數;
		var gunflytime;
		var backtime;
		var movebacktime="";
		var gastime;
		var sumgastime;
		var gasdowntime;
		//移動速度
		var upspeed=4;
		var downspeed=4;
		var leftspeed=6;
		var rightspeed=6;
		//隕石速度
		var back1speed=1.5;
		var back2speed=2.5;
		var back3speed=1.0;
		var back4speed=0.5;
		var back5speed=2;
		$player=$("#player");	//玩家
		$stage=$(".stage");		//背景
		$mygun=$(".mygun");		//子彈
		$icon=$(".icon");		//記分板
		$gas=$(".gas");			//燃料
		//起始設定
		$player.css({
			top:(parseFloat($stage.css("height"))-parseFloat($player.css("height")))/2
		})
		$icon.css({
			left:(parseFloat($stage.css("width"))-parseFloat($icon.css("width")))/2
		})
		$gas.html(gashave)
		$gas.css({
			left:(parseFloat($stage.css("width"))-parseFloat($gas.css("width"))),
			top:10,
			'background-image':"url(gas/gas_"+gashave+".png)",
		})
		//移動隕石
		function moveback(){
			$stage.find(".back1").each(function(){
				$(this).css("left",parseFloat($(this).css("left"))-back1speed)
				//刪除隕石
				if ((parseInt($(this).css("left"))<-320)){
					$(this).remove();
				}
			})
			$stage.find(".back2").each(function(){
				$(this).css("left",parseFloat($(this).css("left"))-back2speed)
				//刪除隕石
				if ((parseInt($(this).css("left"))<-320)){
					$(this).remove();
				}
			})
			$stage.find(".back3").each(function(){
				$(this).css("left",parseFloat($(this).css("left"))-back3speed)
				//刪除隕石
				if ((parseInt($(this).css("left"))<-320)){
					$(this).remove();
				}
			})
			$stage.find(".back4").each(function(){
				$(this).css("left",parseFloat($(this).css("left"))-back4speed)
				//刪除隕石
				if ((parseInt($(this).css("left"))<-320)){
					$(this).remove();
				}
			})
			$stage.find(".back5").each(function(){
				$(this).css("left",parseFloat($(this).css("left"))-back5speed)
				//刪除隕石
				if ((parseInt($(this).css("left"))<-320)){
					$(this).remove();
				}
			})
		}
		//隨機生成(移動)隕石
		function summonback(){
			if (rand(0,sumbackp)==0){
				var list=["<div class='back1 back'>2</div>","<div class='back2  back'>2</div>","<div class='back3  back'>2</div>","<div class='back4  back'>2</div>","<div class='back5  back'>2</div>"];
				var temp=rand(0,4)
				$stage.append(list[temp])
				if (temp==0){
					$find=$stage.find(".back1:last")
					$find.css({
						left:parseInt($stage.css("width")),
						top:rand(-300,600),
					})
				}
				else if (temp==1){
					$find=$stage.find(".back2:last")
					$find.css({
						left:parseInt($stage.css("width")),
						top:rand(-300,600),
					})
				}
				else if (temp==2){
					$find=$stage.find(".back3:last")
					$find.css({
						left:parseInt($stage.css("width")),
						top:rand(-300,600),
					})
				}
				else if (temp==3){
					$find=$stage.find(".back4:last")
					$find.css({
						left:parseInt($stage.css("width")),
						top:rand(-300,600),
					})
				}
				else if (temp==4){
					$find=$stage.find(".back5:last")
					$find.css({
						left:parseInt($stage.css("width")),
						top:rand(-300,600),
					})
				}
			}
		}
		//隨機生成燃料
		function sumgas(){
			if (rand(0,sump)==0){
				$stage.append("<div class='gascon'></div>")
				$find=$stage.find(".gascon:last")
				$find.css({
					top:0-parseInt($find.css("height")),
					left:rand(0,600),
				})
			}
		}
		//燃料下降(刪除)
		function gasdown(){
			$stage.find(".gascon").each(function(){
				$(this).css({
					top:parseFloat($(this).css("top"))+gasspeed,
				})
				if (parseFloat($(this).css("top"))>600){
					$(this).remove();	
				}
			})
		}
		//鍵盤滑鼠事件
			//上下左右移動
			//向上
			$(".up").mousedown(function(){
				clearInterval(timeup)
				timeup=setInterval(function(){
					if (stop=="false"){
						tmp=(parseFloat($player.css("top")))-upspeed
						if (tmp+parseFloat($player.css("height"))/2>parseFloat($stage.css("top"))){
							$player.css("top",tmp)
						}
					}
				},1000/FPS)
			})
			$(".up").mouseup(function(){
				clearInterval(timeup)
			})
			$(".up").mouseout(function(){
				clearInterval(timeup)
			})
			//向下
			$(".down").mousedown(function(){
				clearInterval(timedown)
				timedown=setInterval(function(){
					if (stop=="false"){
						tmp=(parseFloat($player.css("top")))+downspeed
						if (tmp+parseFloat($player.css("height"))/2<parseFloat($stage.css("height"))){
							$player.css("top",tmp)
						}
					}
				},1000/FPS)
			})
			$(".down").mouseup(function(){
				clearInterval(timedown)
			})
			$(".down").mouseout(function(){
				clearInterval(timedown)
			})
			//向右
			$(".right").mousedown(function(){
				clearInterval(timeright)
				timeright=setInterval(function(){
					if (stop=="false"){
						tmp=(parseFloat($player.css("left")))+rightspeed
						if (tmp+parseFloat($player.css("width"))<parseFloat($stage.css("width"))){
							$player.css("left",tmp)
						}
					}
				},1000/FPS)
			})
			$(".right").mouseup(function(){
				clearInterval(timeright)
			})
			$(".right").mouseout(function(){
				clearInterval(timeright)
			})
			//向左
			$(".left").mousedown(function(){
				clearInterval(timeleft)
				timeleft=setInterval(function(){
					if (stop=="false"){
						tmp=(parseFloat($player.css("left")))-leftspeed
						if (tmp>0){
							$player.css("left",tmp)
						}
					}
				},1000/FPS)
			})
			$(".left").mouseup(function(){
				clearInterval(timeleft)
			})
			$(".left").mouseout(function(){
				clearInterval(timeleft)
			})
			//禁止右鍵
			$("body").contextmenu(function(x){
				x.preventDefault();
			})
			//空白建發射子彈
			$("body").keyup(function(x,y){
				if (stop=="false"){
					if (x.key==" "){
						$stage.append("<div class='mygun'></div>")
						$find=$stage.find(".mygun:last");
						$find.css({
							left:parseFloat($player.css("left"))+35,
							top:parseFloat($player.css("top"))+10,
						})
						
					}
					
				}
				
			})
			//遊戲暫停(開啟)
			$("body").keyup(function(x,y){
				if (x.key=="p"||x.key=="P"){
					if (stop=="true"){
						stop="false";
						start="true";
						gastime=setInterval(gas,gasmiss)			//消耗燃料
						sumgastime=setInterval(sumgas,1000)			//生成燃料
						gasdowntime=setInterval(gasdown,1000/FPS)	//燃料下降
						backtime=setInterval(summonback,sumback)	//生成隕石
						movebacktime=setInterval(moveback,1000/FPS)	//隕石移動
						gunflytime=setInterval(gunflying,1000/FPS)	//子彈移動
						$(".stop").remove();
					}
					else if (stop=="false"){
						clearInterval(gastime);
						clearInterval(sumgastime);
						clearInterval(gasdowntime);
						clearInterval(backtime);
						clearInterval(movebacktime);
						clearInterval(gunflytime);
						stop="true";
						$stage.append("<div class='stop'>遊戲暫停，按P開始遊戲</div>");
					}
				}
			})
			//子彈前進
			function gunflying(){
				$findgun=$stage.find(".mygun").each(function(){
					$(this).css("left",parseFloat($(this).css("left"))+gunspped)
					//刪除子彈(超出螢幕)
					if (parseFloat($(this).css("left"))>parseFloat($stage.css("width"))){
						$(this).remove();
					}
				})
			}
		//開始遊戲
		function allstart(){
			stop="false";
			start="true";
			gastime=setInterval(gas,gasmiss)			//消耗燃料
			yn=setInterval(yn,1000/FPS)					//啟用判斷
			sumgastime=setInterval(sumgas,1000)			//生成燃料
			gasdowntime=setInterval(gasdown,1000/FPS)	//燃料下降
			backtime=setInterval(summonback,sumback)	//生成隕石
			movebacktime=setInterval(moveback,1000/FPS)	//隕石移動
			gunflytime=setInterval(gunflying,1000/FPS)	//子彈移動
		}
		allstart();
		//點擊遊戲結束(開始新遊戲)
		$(".gameover").click(function(){
			console.log("start game")
		})
		//遊戲結束
		function gameover(){
			clearInterval(gastime);
			clearInterval(yn);
			clearInterval(sumgastime);
			clearInterval(gasdowntime);
			clearInterval(backtime);
			clearInterval(movebacktime);
			clearInterval(gunflytime);
			stop="true";
			$stage.append("<div class='gameover'>遊戲結束，點擊螢幕開始遊戲</div>");
		}
		//燃料消耗
		function gas(){
			if (gashave>0){
				gashave=gashave-1;
				$gas.html(gashave)
				$gas.css({
					'background-image':"url(gas/gas_"+gashave+".png)"
				})
			}
			else{
				gameover();
			}
		}
		//隨機整數
		function rand(nn,mm){
			var num=parseInt(Math.random()*(mm-nn+1))+nn
			return num;
		}
		//判斷
		function yn(){
			//判斷子彈位置
			$stage.find(".back").each(function(){
				var tt=$(this)
				var find=$stage.find(".mygun").each(function(){
					if (parseFloat($(this).css("top"))+parseFloat($(this).css("height"))/2>parseFloat(tt.css("top"))//上
					&&parseFloat($(this).css("top"))+parseFloat($(this).css("height"))/2<parseFloat(tt.css("top"))+parseFloat(tt.css("height"))//下
					&&parseFloat($(this).css("left"))+parseFloat($(this).css("width"))/2>parseFloat(tt.css("left"))//左
					&&parseFloat($(this).css("left"))+parseFloat($(this).css("width"))/2<parseFloat(tt.css("left"))+parseFloat(tt.css("width")))//右
					{
						//擊中隕石(消除子彈)
						if (tt.text()==2){
							$(this).remove();
							tt.html(1);
						}
						else{
							//加分
							$(".icon").html(parseInt($(".icon").text())+score+"得分");
							//消除隕石子彈
							$(this).remove();
							tt.remove();
						}
					}
				})
				//玩家碰撞隕石
				if (parseFloat($player.css("top"))+parseFloat($player.css("height"))/2>parseFloat($(this).css("top"))//上
					&&parseFloat($player.css("top"))+parseFloat($player.css("height"))/2<parseFloat($(this).css("top"))+parseFloat($(this).css("height"))//下
					&&parseFloat($player.css("left"))+parseFloat($player.css("width"))/2>parseFloat($(this).css("left"))//左
					&&parseFloat($player.css("left"))+parseFloat($player.css("width"))/2<parseFloat($(this).css("left"))+parseFloat($(this).css("width")))//右
					{
						//撞到隕石減少燃料
						if (gashave>backattack){
							gashave=gashave-backattack;
							$(this).remove();
							$gas.css({
								'background-image':"url(gas/gas_"+gashave+".png)",
							})
						}
						else {//遊戲結束
							$(this).remove();
							gameover();
						}
					}
				})
			//碰到燃料
			$stage.find(".gascon").each(function(){
				if (parseFloat($player.css("top"))+parseFloat($player.css("height"))>parseFloat($(this).css("top"))//上
					&&parseFloat($player.css("top"))<parseFloat($(this).css("top"))+parseFloat($(this).css("height"))//下
					&&parseFloat($player.css("left"))+parseFloat($player.css("width"))>parseFloat($(this).css("left"))//左
					&&parseFloat($player.css("left"))<parseFloat($(this).css("left"))+parseFloat($(this).css("width")))//右
					{
						if (gashave<15){
							gashave=gashave+15;
							$gas.css({
								'background-image':"url(gas/gas_"+gashave+".png)",
							})
						}
						else{
							gashave=30;
							$gas.css({
								'background-image':"url(gas/gas_"+gashave+".png)",
							})
						}
						$(this).remove();
					}
			})
		}
	})
</script>
<style type="text/css">
	.stage{
		background:url("image/stage.jpg");
		width:960px;	
		height:600px;
		position:absolute;
		top:0; left:0; right:0; bottom:0;
		margin:auto;
		overflow: hidden;
	}
	.player{
		background:url("image/fly.png");
		width: 50px;
		height: 30px;
		position: absolute;
		z-index: 10;
	}
	.move{
		width: 40px;
		height: 40px;
		position: absolute;
		z-index: 11;
	}
	.up{
		background:url("image/up.png");
		left: 40px;
		top: 480px;
	}
	.down{
		background:url("image/down.png");
		left: 40px;
		top: 560px;
	}
	.left{
		background:url("image/left.png");
		left: 0px;
		top: 520px;
	}
	.right{
		background:url("image/right.png");
		left: 80px;
		top: 520px;
	}
	.midden{
		background:url("image/midden.png");
		left: 40px;
		top: 520px;
	}
	.mygun{
		background:url("image/mygun.png");
		position: absolute;
		width: 20px;
		height: 10px;
	}
	.back1{
		position: absolute;
		width: 230px;
		height: 220px;
		background: url(image/back1.png);
	}
	.back2{
		position: absolute;
		width: 320px;
		height: 318px;
		background: url(image/back2.png);
	}
	.back3{
		position: absolute;
		width: 68px;
		height: 66px;
		background: url(image/back3.png);
	}
	.back4{
		position: absolute;
		width: 48px;
		height: 44px;
		background: url(image/back4.png);
	}
	.back5{
		position: absolute;
		width: 180px;
		height: 180px;
		background: url(image/back5.png);
	}
	.back{
		font-size:0px;
	}
	.text{
		left: 300px;
		top: 200px;
	}
	.icon{
		position: absolute;
		width: 300px;
		height: 40px;
		background: url("image/icon.png");
		font-size: 60px;
		text-align: center;
		color: gold;
		left: 390px;
		z-index: 8;
		user-select: none;
	}
	.gas{
		position: absolute;
		width: 300px;
		height: 32px;
		left: 600px;
		z-index: 9;
	}
	.gastext{
		position: absolute;
		color: gold;
		font-size: 30px;
		top: 8px;
		left: 600px;
		z-index: 8;
		user-select: none;
	}
	.misstext{
		font-size: 0px;
	}
	.gascon{
		width: 44px;
		height: 61px;
		position: absolute;
		background: url("image/gas.png");
	}
	.stop{
		position: absolute;
		width: 960px;
		height: 600px;
		background: url("image/stop.png");
		user-select: none;
		z-index: 20;
		text-align: center;
		font-size: 80px;
		color: red;
		line-height:560px;
	}
	.gameover{
		position: absolute;
		width: 960px;
		height: 600px;
		background: url("image/stop.png");
		user-select: none;
		z-index: 20;
		text-align: center;
		font-size: 80px;
		color: red;
		line-height:560px;
	}
</style>
</head>
	
<body>
	<div class="stage">
		<div class="player" id="player"></div>
		<!--移動(上，下，左，右，中)-->
		<div class="move up"></div>
		<div class="move down"></div>
		<div class="move left"></div>
		<div class="move right"></div>
		<div class="move midden"></div>
		<div class="icon">0得分</div>
		<div class='gas misstext' id="gas"></div>
		<div class='gastext'>燃料</div>
	</div>
</body>
	
</html>
