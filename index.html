<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>無標題文件</title>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
<script src="http://code.jquery.com/jquery-1.8.3.js"></script>
<script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
<script>
	$(function(){
		var st;
		var tmp;
		var start="false";
		var timeup;
		var timedown;
		var timeright;
		var timeleft
		var $find;
		var $findgun;
		var $overfind;
		var enemygunspeed=3;//敵人子彈速度
		var gunspped=8; 	//子彈速度
		var sumbackp=300; 	//生成隕石機率sumbackp分之1
		var score=10; 		//擊破隕石得分數
		var FPS=60;
		var gasmiss=1000;	//燃料消耗速度
		var gashave=15;		//初始燃料
		var backattack=15;	//撞到隕石損失的燃料
		var sump=5;			//燃料生成機率sump/1s
		var gasspeed=1;		//汽油下降速度
		var stop="true";	//檢查遊戲是否暫停
		var enemyspeed=2; 	//敵人戰艦移動速度
		var sumenemyp=500;	//生成敵人機率sumenemyp/(1000/FPS)s
		var shootgunp=500;	//敵人射擊機率
		var addtime=0;		//每5秒增強敵人
		//循環時間變數;
		var gunflytime;
		var backtime;
		var movebacktime="";
		var gastime;
		var sumgastime;
		var gasdowntime;
		var summonenemytime;
		var moveenemytime;
		var enemygun;
		var movegun;
		//移動速度
		var upspeed=4;
		var downspeed=4;
		var leftspeed=6;
		var rightspeed=6;
		//隕石速度
		var back1speed=1.5;
		var back2speed=2.5;
		var back3speed=1.0;
		var back4speed=0.5;
		var back5speed=2;
		$player=$("#player");	//玩家
		$stage=$(".stage");		//背景
		$mygun=$(".mygun");		//子彈
		$icon=$(".icon");		//記分板
		$gas=$(".gas");			//燃料
		//開啟計時器
		function starttime(){
			stop="false";
			start="true";
			gastime=setInterval(gas,gasmiss)				//1.消耗燃料
			st=setInterval(yn,1000/FPS)						//2.啟用判斷
			sumgastime=setInterval(sumgas,1000)				//3.生成燃料
			gasdowntime=setInterval(gasdown,1000/FPS)		//4.燃料下降
			backtime=setInterval(summonback,1000/FPS)		//5.生成隕石
			movebacktime=setInterval(moveback,1000/FPS)		//6.隕石移動
			gunflytime=setInterval(gunflying,1000/FPS)		//7.子彈移動
			summonenemytime=setInterval(sumenemy,1000/FPS)	//8.生成敵人
			moveenemytime=setInterval(moveenemy,1000/FPS)	//9.敵人移動
			enemygun=setInterval(enemyshoot,1000/FPS)		//10.敵人射擊
			movegun=setInterval(gunmove,1000/FPS)			//11.敵人子彈移動
		}
		function text(){
			stop="false";
			start="true";
			st=setInterval(yn,1000/FPS)
			gunflytime=setInterval(gunflying,1000/FPS)
			enemygun=setInterval(enemyshoot,1000/FPS)
			moveenemytime=setInterval(moveenemy,1000/FPS)
			movegun=setInterval(gunmove,1000/FPS)
		}
		starttime()
		//關閉計時器
		function offtime(){
			stop="true";
			start="false";
			clearInterval(gastime);			
			clearInterval(sumgastime);		
			clearInterval(gasdowntime);
			clearInterval(backtime);
			clearInterval(movebacktime);
			clearInterval(gunflytime);
			clearInterval(st);				
			clearInterval(summonenemytime);
			clearInterval(moveenemytime);
			clearInterval(enemygun);
			clearInterval(movegun);	
		}
		//起始設定
		$player.css({
			top:(parseFloat($stage.css("height"))-parseFloat($player.css("height")))/2
		})
		$icon.css({
			left:(parseFloat($stage.css("width"))-parseFloat($icon.css("width")))/2
		})
		$gas.html(gashave)
		$gas.css({
			left:(parseFloat($stage.css("width"))-parseFloat($gas.css("width"))),
			top:10,
			'background-image':"url(gas/gas_"+gashave+".png)",
		})
		//移動隕石
		function moveback(){
			$stage.find(".back1").each(function(){
				$(this).css("left",parseFloat($(this).css("left"))-back1speed)
				//刪除隕石
				if ((parseInt($(this).css("left"))<-320)){
					$(this).remove();
				}
			})
			$stage.find(".back2").each(function(){
				$(this).css("left",parseFloat($(this).css("left"))-back2speed)
				//刪除隕石
				if ((parseInt($(this).css("left"))<-320)){
					$(this).remove();
				}
			})
			$stage.find(".back3").each(function(){
				$(this).css("left",parseFloat($(this).css("left"))-back3speed)
				//刪除隕石
				if ((parseInt($(this).css("left"))<-320)){
					$(this).remove();
				}
			})
			$stage.find(".back4").each(function(){
				$(this).css("left",parseFloat($(this).css("left"))-back4speed)
				//刪除隕石
				if ((parseInt($(this).css("left"))<-320)){
					$(this).remove();
				}
			})
			$stage.find(".back5").each(function(){
				$(this).css("left",parseFloat($(this).css("left"))-back5speed)
				//刪除隕石
				if ((parseInt($(this).css("left"))<-320)){
					$(this).remove();
				}
			})
		}
		//隨機生成隕石
		function summonback(){
			if (rand(0,sumbackp)==0){
				var list=["<div class='back1 back'>2</div>","<div class='back2  back'>2</div>","<div class='back3  back'>2</div>","<div class='back4  back'>2</div>","<div class='back5  back'>2</div>"];
				var temp=rand(0,4)
				$stage.append(list[temp])
				if (temp==0){
					$find=$stage.find(".back1:last")
					$find.css({
						left:parseInt($stage.css("width")),
						top:rand(-300,600),
					})
				}
				else if (temp==1){
					$find=$stage.find(".back2:last")
					$find.css({
						left:parseInt($stage.css("width")),
						top:rand(-300,600),
					})
				}
				else if (temp==2){
					$find=$stage.find(".back3:last")
					$find.css({
						left:parseInt($stage.css("width")),
						top:rand(-300,600),
					})
				}
				else if (temp==3){
					$find=$stage.find(".back4:last")
					$find.css({
						left:parseInt($stage.css("width")),
						top:rand(-300,600),
					})
				}
				else if (temp==4){
					$find=$stage.find(".back5:last")
					$find.css({
						left:parseInt($stage.css("width")),
						top:rand(-300,600),
					})
				}
			}
		}
		//隨機生成燃料
		function sumgas(){
			if (rand(0,sump)==0){
				$stage.append("<div class='gascon'></div>")
				$find=$stage.find(".gascon:last")
				$find.css({
					top:0-parseInt($find.css("height")),
					left:rand(0,600),
				})
			}
		}
		//燃料下降(刪除)
		function gasdown(){
			$stage.find(".gascon").each(function(){
				$(this).css({
					top:parseFloat($(this).css("top"))+gasspeed,
				})
				if (parseFloat($(this).css("top"))>600){
					$(this).remove();	
				}
			})
		}
		//敵人發射子彈
		function enemyshoot(){
			$stage.find(".allenemy").each(function(){
				if (rand(0,shootgunp)==0){
					$stage.append("<div class='enemygun'></div>")
					$find=$stage.find(".enemygun:last")
					$find.css({
						top:parseFloat($(this).css("top"))+parseFloat($(this).css("height"))/2,
						left:parseFloat($(this).css("left")),
					})
				}
				
			})
		}
		//敵人子彈移動
		function gunmove(){
			$stage.find(".enemygun").each(function(){
				$(this).css("left",parseFloat($(this).css("left"))-enemygunspeed)
					//刪除子彈(超出螢幕)
					if (parseFloat($(this).css("left"))<0){
						$(this).remove();
					}
			})
		}
		//鍵盤滑鼠事件
			//上下左右移動
			//向上
			$(".up").mousedown(function(){
				clearInterval(timeup)
				timeup=setInterval(function(){
					if (stop=="false"){
						tmp=(parseFloat($player.css("top")))-upspeed
						if (tmp+parseFloat($player.css("height"))/2>parseFloat($stage.css("top"))){
							$player.css("top",tmp)
						}
					}
				},1000/FPS)
			})
			$(".up").mouseup(function(){
				clearInterval(timeup)
			})
			$(".up").mouseout(function(){
				clearInterval(timeup)
			})
			//向下
			$(".down").mousedown(function(){
				clearInterval(timedown)
				timedown=setInterval(function(){
					if (stop=="false"){
						tmp=(parseFloat($player.css("top")))+downspeed
						if (tmp+parseFloat($player.css("height"))/2<parseFloat($stage.css("height"))){
							$player.css("top",tmp)
						}
					}
				},1000/FPS)
			})
			$(".down").mouseup(function(){
				clearInterval(timedown)
			})
			$(".down").mouseout(function(){
				clearInterval(timedown)
			})
			//向右
			$(".right").mousedown(function(){
				clearInterval(timeright)
				timeright=setInterval(function(){
					if (stop=="false"){
						tmp=(parseFloat($player.css("left")))+rightspeed
						if (tmp+parseFloat($player.css("width"))<parseFloat($stage.css("width"))){
							$player.css("left",tmp)
						}
					}
				},1000/FPS)
			})
			$(".right").mouseup(function(){
				clearInterval(timeright)
			})
			$(".right").mouseout(function(){
				clearInterval(timeright)
			})
			//向左
			$(".left").mousedown(function(){
				clearInterval(timeleft)
				timeleft=setInterval(function(){
					if (stop=="false"){
						tmp=(parseFloat($player.css("left")))-leftspeed
						if (tmp>0){
							$player.css("left",tmp)
						}
					}
				},1000/FPS)
			})
			$(".left").mouseup(function(){
				clearInterval(timeleft)
			})
			$(".left").mouseout(function(){
				clearInterval(timeleft)
			})
			//禁止右鍵
			$("body").contextmenu(function(x){
				x.preventDefault();
			})
			//空白建發射子彈
			$("body").keyup(function(x,y){
				if (stop=="false"){
					if (x.key==" "){
						$stage.append("<div class='mygun'></div>")
						$find=$stage.find(".mygun:last");
						$find.css({
							left:parseFloat($player.css("left"))+35,
							top:parseFloat($player.css("top"))+10,
						})
					}
				}
			})
			//遊戲暫停(開啟)
			$("body").keyup(function(x,y){
				if (start=="true"){
					if (x.key=="p"||x.key=="P"){
						if (stop=="true"){
							starttime();
							$(".stop").remove();
						}
						else if (stop=="false"){
							offtime();
							start="true";
							$stage.append("<div class='stop'>遊戲暫停，按P開始遊戲</div>");
						}
					}
				}
			})
			//子彈前進
			function gunflying(){
				$findgun=$stage.find(".mygun").each(function(){
					$(this).css("left",parseFloat($(this).css("left"))+gunspped)
					//刪除子彈(超出螢幕)
					if (parseFloat($(this).css("left"))>parseFloat($stage.css("width"))){
						$(this).remove();
					}
				})
			}
		//遊戲結束
		function gameover(){
			offtime();
			$stage.append("<div class='gameover' id='gameover'>遊戲結束，點擊螢幕開始遊戲</div>");
			//(開始新遊戲)
			$(".gameover").mousedown(function(){
				//清理雜物
				$(".gascon").remove();
				$(".mygun").remove();
				$(".back").remove();
				$(".gameover").remove();
				$(".allenemy").remove();
				//變數重設
				sumbackp=100; 	//生成隕石機率sumbackp分之1
				score=10; 		//擊破隕石得分數
				FPS=60;
				gasmiss=1000;	//燃料消耗速度
				gashave=15;		//初始燃料
				backattack=15;	//撞到隕石損失的燃料
				sump=5;			//燃料生成機率sump/1s
				gasspeed=1;		//汽油下降速度
				stop="false";	//檢查遊戲是否暫停
				start="true";
				$(".icon").html("0得分");
				//位置重刷
				$player.css({
					top:(parseFloat($stage.css("height"))-parseFloat($player.css("height")))/2,
					left:0,
				})
				$icon.css({
					left:(parseFloat($stage.css("width"))-parseFloat($icon.css("width")))/2
				})
				$gas.html(gashave)
				$gas.css({
					left:(parseFloat($stage.css("width"))-parseFloat($gas.css("width"))),
					top:10,
					'background-image':"url(gas/gas_"+gashave+".png)",
				})
				//系統重啟
				starttime();
			})
		}
		//燃料消耗
		function gas(){
			if (gashave>0){
				gashave=gashave-1;
				$gas.html(gashave)
				$gas.css({
					'background-image':"url(gas/gas_"+gashave+".png)"
				})
			}
			else{
				stop=="true";
				start="false";
				gameover();
			}
		}
		//生成智能AI
		function sumenemy(){
			if (rand(0,sumenemyp)==0){
				var list=["<div class='enemy1 allenemy'></div>","<div class='enemy2 allenemy'></div>","<div class='enemy3 allenemy'></div>"];
				$stage.append(list[rand(0,2)]);
				$find=$stage.find(".allenemy:last");
				$find.css({
					top:rand(0,600-parseInt($find.css("height"))),
					left:parseFloat($stage.css("width")),
				})
			}
			
		}
		//智能AI移動
		function moveenemy(){
			$stage.find(".allenemy").each(function(){
				$(this).css("left",parseFloat($(this).css("left"))-enemyspeed)
				//刪除AI
				if ((parseInt($(this).css("left"))<-60)){
					$(this).remove();
				}
			})
		}
		//隨機整數
		function rand(nn,mm){
			var num=parseInt(Math.random()*(mm-nn+1))+nn
			return num;
		}
		//判斷
		function yn(){
			//判斷子彈位置(隕石)
			$stage.find(".back").each(function(){
				var tt=$(this)
				var find=$stage.find(".mygun").each(function(){
					if (parseFloat($(this).css("top"))+parseFloat($(this).css("height"))/2>parseFloat(tt.css("top"))//上
					&&parseFloat($(this).css("top"))+parseFloat($(this).css("height"))/2<parseFloat(tt.css("top"))+parseFloat(tt.css("height"))//下
					&&parseFloat($(this).css("left"))+parseFloat($(this).css("width"))/2>parseFloat(tt.css("left"))//左
					&&parseFloat($(this).css("left"))+parseFloat($(this).css("width"))/2<parseFloat(tt.css("left"))+parseFloat(tt.css("width")))//右
					{
						//擊中隕石(消除子彈)
						if (tt.text()==2){
							$(this).remove();
							tt.html(1);
						}
						else{
							//加分
							$(".icon").html(parseInt($(".icon").text())+score+"得分");
							//消除隕石子彈
							$(this).remove();
							tt.remove();
						}
					}
				})
				//玩家碰撞隕石
				if (parseFloat($player.css("top"))+parseFloat($player.css("height"))/2>parseFloat($(this).css("top"))//上
					&&parseFloat($player.css("top"))+parseFloat($player.css("height"))/2<parseFloat($(this).css("top"))+parseFloat($(this).css("height"))//下
					&&parseFloat($player.css("left"))+parseFloat($player.css("width"))/2>parseFloat($(this).css("left"))//左
					&&parseFloat($player.css("left"))+parseFloat($player.css("width"))/2<parseFloat($(this).css("left"))+parseFloat($(this).css("width")))//右
					{
						//撞到隕石減少燃料
						if (gashave>backattack){
							gashave=gashave-backattack;
							$(this).remove();
							$gas.css({
								'background-image':"url(gas/gas_"+gashave+".png)",
							})
						}
						else {//遊戲結束
							stop=="true";
							start="false";
							$(this).remove();
							gameover();
						}
					}
				})
			//玩家碰到燃料
			$stage.find(".gascon").each(function(){
				if (parseFloat($player.css("top"))+parseFloat($player.css("height"))>parseFloat($(this).css("top"))//上
					&&parseFloat($player.css("top"))<parseFloat($(this).css("top"))+parseFloat($(this).css("height"))//下
					&&parseFloat($player.css("left"))+parseFloat($player.css("width"))>parseFloat($(this).css("left"))//左
					&&parseFloat($player.css("left"))<parseFloat($(this).css("left"))+parseFloat($(this).css("width")))//右
					{
						if (gashave<15){
							gashave=gashave+15;
							$gas.css({
								'background-image':"url(gas/gas_"+gashave+".png)",
							})
						}
						else{
							gashave=30;
							$gas.css({
								'background-image':"url(gas/gas_"+gashave+".png)",
							})
						}
						$(this).remove();
					}
			})
			//判斷子彈位置(打敵人)
			$stage.find(".allenemy").each(function(){
				var tt=$(this)
				var find=$stage.find(".mygun").each(function(){
					if (parseFloat($(this).css("top"))+parseFloat($(this).css("height"))/2>parseFloat(tt.css("top"))//上
					&&parseFloat($(this).css("top"))+parseFloat($(this).css("height"))/2<parseFloat(tt.css("top"))+parseFloat(tt.css("height"))//下
					&&parseFloat($(this).css("left"))+parseFloat($(this).css("width"))/2>parseFloat(tt.css("left"))//左
					&&parseFloat($(this).css("left"))+parseFloat($(this).css("width"))/2<parseFloat(tt.css("left"))+parseFloat(tt.css("width")))//右
					{
						//擊中敵人(消除子彈)
						if (tt.text()==2){
							$(this).remove();
							tt.html(1);
						}
						else{
							//加分
							$(".icon").html(parseInt($(".icon").text())+score+"得分");
							//消除敵人&子彈
							$(this).remove();
							tt.remove();
						}
					}
				})
				if (parseFloat($player.css("top"))+parseFloat($player.css("height"))>parseFloat($(this).css("top"))//上
					&&parseFloat($player.css("top"))<parseFloat($(this).css("top"))+parseFloat($(this).css("height"))//下
					&&parseFloat($player.css("left"))+parseFloat($player.css("width"))>parseFloat($(this).css("left"))//左
					&&parseFloat($player.css("left"))<parseFloat($(this).css("left"))+parseFloat($(this).css("width")))//右
					{
						//撞到敵人減少燃料
						if (gashave>backattack){
							gashave=gashave-backattack;
							$(this).remove();
							$gas.css({
								'background-image':"url(gas/gas_"+gashave+".png)",
							})
						}
						else {//遊戲結束
							stop=="true";
							start="false";
							$(this).remove();
							gameover();
						}
					}
			})
			//判斷子彈位置(被敵人打)
			$stage.find(".enemygun").each(function(){
				//玩家碰到敵人子彈
				
				if (parseFloat($player.css("top"))+parseFloat($player.css("height"))>parseFloat($(this).css("top"))//上
					&&parseFloat($player.css("top"))<parseFloat($(this).css("top"))+parseFloat($(this).css("height"))//下
					&&parseFloat($player.css("left"))+parseFloat($player.css("width"))>parseFloat($(this).css("left"))//左
					&&parseFloat($player.css("left"))<parseFloat($(this).css("left"))+parseFloat($(this).css("width")))//右
					{
						//撞到子彈減少燃料
						if (gashave>backattack){
							gashave=gashave-backattack;
							$(this).remove();
							$gas.css({
								'background-image':"url(gas/gas_"+gashave+".png)",
							})
						}
						else {//遊戲結束
							stop=="true";
							start="false";
							$(this).remove();
							gameover();
						}
					}
			})
		}
	})
</script>
<style type="text/css">
	.stage{
		background:url("image/stage.jpg");
		width:960px;	
		height:600px;
		position:absolute;
		top:0; left:0; right:0; bottom:0;
		margin:auto;
		overflow: hidden;
	}
	.player{
		background:url("image/fly.png");
		width: 50px;
		height: 30px;
		position: absolute;
		z-index: 10;
	}
	.move{
		width: 40px;
		height: 40px;
		position: absolute;
		z-index: 11;
	}
	.up{
		background:url("image/up.png");
		left: 40px;
		top: 480px;
	}
	.down{
		background:url("image/down.png");
		left: 40px;
		top: 560px;
	}
	.left{
		background:url("image/left.png");
		left: 0px;
		top: 520px;
	}
	.right{
		background:url("image/right.png");
		left: 80px;
		top: 520px;
	}
	.midden{
		background:url("image/midden.png");
		left: 40px;
		top: 520px;
	}
	.mygun{
		background:url("image/mygun.png");
		position: absolute;
		width: 20px;
		height: 10px;
	}
	.back1{
		position: absolute;
		width: 230px;
		height: 220px;
		background: url(image/back1.png);
	}
	.back2{
		position: absolute;
		width: 320px;
		height: 318px;
		background: url(image/back2.png);
	}
	.back3{
		position: absolute;
		width: 68px;
		height: 66px;
		background: url(image/back3.png);
	}
	.back4{
		position: absolute;
		width: 48px;
		height: 44px;
		background: url(image/back4.png);
	}
	.back5{
		position: absolute;
		width: 180px;
		height: 180px;
		background: url(image/back5.png);
	}
	.back{
		font-size:0px;
	}
	.text{
		left: 700px;
		top: 200px;
	}
	.icon{
		position: absolute;
		width: 300px;
		height: 40px;
		background: url("image/icon.png");
		font-size: 60px;
		text-align: center;
		color: gold;
		left: 390px;
		z-index: 8;
		user-select: none;
	}
	.gas{
		position: absolute;
		width: 300px;
		height: 32px;
		left: 600px;
		z-index: 9;
	}
	.gastext{
		position: absolute;
		color: gold;
		font-size: 30px;
		top: 8px;
		left: 600px;
		z-index: 8;
		user-select: none;
	}
	.misstext{
		font-size: 0px;
	}
	.gascon{
		width: 44px;
		height: 61px;
		position: absolute;
		background: url("image/gas.png");
	}
	.stop{
		position: absolute;
		width: 960px;
		height: 600px;
		background: url("image/stop.png");
		user-select: none;
		z-index: 20;
		text-align: center;
		font-size: 80px;
		color: red;
		line-height:560px;
	}
	.gameover{
		position: absolute;
		width: 960px;
		height: 600px;
		background: url("image/stop.png");
		user-select: none;
		z-index: 20;
		text-align: center;
		font-size: 60px;
		color: red;
		line-height:560px;
	}
	.bg1{
		position: absolute;
		background: url("image/bg_1.png");
		width: 164px;
		height: 156px;
		left: 60px;
		top: 5px;
	}
	.bg2{
		position: absolute;
		background: url("image/bg_2.png");
		width:399px;
		height: 363px;
		left: 150px;
		top: 50px;
	}
	.bg3{
		position: absolute;
		background: url("image/bg_3.png");
		width: 167px;
		height: 162px;
		left: 200px;
		top: 400px;
	}
	.bg4{
		position: absolute;
		background: url("image/bg_4.png");
		width:430px;
		height:307px;
		left:600px;
		top: 260px;
	}
	.bg5{
		position: absolute;
		background: url("image/bg_5.png");
		width: 177px;
		height: 167px;
		left: 560px;
		top: 20px;
	}
	.allenemy{
		z-index: 5;
	}
	.enemy1{
		position: absolute;
		width: 48px;
		height: 42px;
		background: url("enemy/enemy_1.png");
	}
	.enemy2{
		position: absolute;
		width: 48px;
		height: 41px;
		background: url("enemy/enemy_2.png");
	}
	.enemy3{
		position: absolute;
		width: 48px;
		height: 41px;
		background: url("enemy/enemy_3.png");
	}
	.enemygun{
		z-index: 4;
		background: url("enemy/enemygun.png");
		width: 20px;
		height: 5px;
		position: absolute;
	}
</style>
</head>
	
<body>
	<div class="stage">
		<div class="player" id="player"></div>
		<!--移動(上，下，左，右，中)-->
		<div class="move up"></div>
		<div class="move down"></div>
		<div class="move left"></div>
		<div class="move right"></div>
		<div class="move midden"></div>
		<div class="icon">0得分</div>
		<div class='gas misstext' id="gas"></div>
		<div class='gastext'>燃料</div>
		<div class='bg1'></div>
		<div class='bg2'></div>
		<div class='bg3'></div>
		<div class='bg4'></div>
		<div class='bg5'></div>
	</div>
</body>
	
</html>
